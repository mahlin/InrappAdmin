@model InrappAdmin.Web.Models.ViewModels.IndexViewModel
@{
    ViewBag.Title = "Kontohantering";
}

<link href="~/Scripts//bootstrap-multiselect/dist/css/bootstrap-multiselect.css" rel="stylesheet" type="text/css" />
<script src="~/Scripts/bootstrap-multiselect/dist/js/bootstrap-multiselect.js" type="text/javascript"></script>

<script type="text/javascript">
    var register = @Html.Raw(Json.Encode(Model.RegisterList));

    $(document).ready(function () {

        $('[id*=RegList]').multiselect({
            onInitialized: function() {
                $.each(register, function (index, item) {
                    if (item.Selected) {
                        $("#RegList > option")[index].selected = true;
                        $("#RegList > option")[index].checked = true;
                    }
                });
                this.refresh();
            },
            onChange: function (option, checked, select) {
                $.each(register, function(index, item) {
                    if ($('#RegisterList_' + index + '__Id').val() === $(option).val()) {
                        if ($('#RegisterList_' + index + '__Selected').val() === 'False')
                            $('#RegisterList_' + index + '__Selected').val('True');
                        else
                            $('#RegisterList_' + index + '__Selected').val('False');
                    }
                });
            },
            onSelectAll: function() {
                $.each(register, function (index, item) {
                    $('#RegisterList_' + index + '__Selected').val('True');
                });
            },
            onDeselectAll: function () {
                $.each(register, function (index, item) {
                    $('#RegisterList_' + index + '__Selected').val('False');
                });
            },
            includeSelectAllOption: true,
            nonSelectedText: 'Inget valt',
            allSelectedText: 'Alla valda',
            selectAllText: "Välj alla",
            nSelectedText: "valda"
        });

    });
</script>
<div class="padding-top-55">
    <h2>@ViewBag.Title</h2> 
</div>


<p class="text-success">@ViewBag.StatusMessage</p>
<div>
    <h4>Ändra dina kontouppgifter</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>Lösenord:</dt>
        <dd style="padding-left: 15px">
            [
            @if (Model.HasPassword)
            {
            @Html.ActionLink("Ändra lösenord", "ChangePassword")
            }
            else
            {
            @Html.ActionLink("Ange lösenord", "SetPassword")
            }
            ]
        </dd>
        <dt>Mobilnummer:</dt>
        <dd style="padding-left: 15px">
            @(Model.PhoneNumber ?? "Saknas")
            [
            @if (Model.PhoneNumber != null)
            {
                @Html.ActionLink("Ändra", "AddPhoneNumber")
            }
            else
            {
                @Html.ActionLink("Lägg till", "AddPhoneNumber")
            }
            ]
        </dd>
        <dt>Namn:</dt>
        <dd style="padding-left: 15px">
            @(Model.Namn ?? "Saknas")
            [
            @Html.ActionLink("Ändra namn", "ChangeName")
            ]
        </dd>

    </dl>
    <!--  Ändra valda register  att rapportera till -->
    @using (Html.BeginForm("ChangeChosenRegisters", "Manage", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
    {
        if (Model.RegisterList != null)
        {
            for (int i = 0; i < Model.RegisterList.Count; i++)
            {
                @Html.HiddenFor(x => x.RegisterList[i].Id)
                @Html.HiddenFor(x => x.RegisterList[i].Namn)
                @Html.HiddenFor(x => x.RegisterList[i].Selected)
            }
        }
        @Html.AntiForgeryToken()
        <div class="form-group">
            @Html.Label("Välj register: ", new { @class = "col-md-2 control-label" })
            <div class="col-md-10">
                <select id="RegList" multiple="multiple">
                    @for (var i = 0; i < Model.RegisterList.Count; i++)
                    {
                        <option value=@Model.RegisterList[i].Id>@Model.RegisterList[i].Namn</option>
                    }
                </select>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" class="btn btn-default" value="Spara valda register" />
            </div>
        </div>
    }

</div>
